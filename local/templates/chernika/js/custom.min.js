var SITE_TEMPLATE_PATH="/local/templates/chernika/";function isValidEmailAddress(e){return new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i).test(e)}function afterChangeBasket(e){$(".js-basket_count").text(e.COUNT),0<e.basket.length&&$(".js-cart_wrapper .cart-wrapper").html($(e.basket).find(" .cart-wrapper").html())}function maskInput(){$("#ORDER_PROP_3").mask("+7(999) 999 99-99",{placeholder:"_"}),$(".phonemask").mask("+7(999) 999 99-99",{placeholder:"_"}), $('.js-phone-mask').mask("+7(999) 999 99-99",{placeholder:"_"})}function changeOfferParams(e,a){e=(e=e.replace(/'/g,'"')).replace(/amp;/g,"");var t=JSON.parse(e),i=a.data("code");if(t[i]){var r=a.parent().closest(".js-prod_card"),s="",e="",n="",a="";if(r.find(".js-prod_buy_wrap").hasClass("orderprice")||(0<parseInt(t[i].OLD_PRICE)?e+='<div class="price"><p><span class="price-title">Цена в салоне:</span><span class="price-before">'+t[i].OLD_PRICE+' <span>₽</span></span></p></div><div class="price"><p><span class="price-title">Цена со скидкой:</span><span class="price-after  js-prod_price_value">'+t[i].PRICE+" <span>₽</span></span></p></div>":e+='<div class="price"><p>Цена:<span class="price-current js-prod_price_value">'+t[i].PRICE+" <span>₽</span></span></p></div>",r.find(".js-prod_price").html(e),r.find(".js-prod_nalichie").removeClass("nalichie_no"),0<t[i].QUANTITY?(a=r.find(".js-prod_buy_wrap").hasClass("order")?'<div class="buy-btn js-prod_order" data-id="'+t[i].ID+'"><a href="#">Купить со скидкой</a></div>':'<div class="buy-btn buy-btn_short js-buy" data-id="'+t[i].ID+'"><a href="#">Купить</a></div>',r.find(".js-prod_nalichie").html("Есть в наличии"),r.find(".js-count_wrap").attr("data-count",t[i].QUANTITY),r.find(".js-count_wrap").show()):(a='<div class="buy-btn js-prod_preorder" data-id="'+t[i].ID+'"><a href="#">Оформить предзаказ</a></div>',r.find(".js-prod_nalichie").addClass("nalichie_no"),r.find(".js-prod_nalichie").html("Нет в наличии"),r.find(".js-count_wrap").attr("data-count",0),r.find(".js-count_wrap").hide()),r.find(".js-prod_buy_wrap").html(a)),r.find(".js-prod_order").attr("data-id",t[i].ID),r.find(".js-prod_order_spb").attr("data-id",t[i].ID),t[i].PICTURE){for(p in s='<div class="product-page-slider product-page-slider_initialized">',t[i].PICTURE)s+='<div class="product-page-slider-item"><img src="'+t[i].PICTURE[p]+'" alt="" class="img-responsive js-prod_img"></div>';if(s+="</div>",1<t[i].PICTURE.length){for(p in s+='<div class="product-page-slider-thumbs">',t[i].PICTURE)s+='<div class="product-page-slider-thumbs-item slick-initialized"><img src="'+t[i].PICTURE[p]+'" alt="" class="js-prod_img_thumb"></div>';s+="</div>"}$(".product-page-slider").slick("destroy"),$(".product-page-slider-thumbs").slick("destroy"),$(".product-page-slider-item").trigger("destroy"),r.find(".js-product_page_slider").html(s),$(".product-page-slider").slick({arrows:!1,dots:!0,mobileFirst:!0,asNavFor:".product-page-slider-thumbs",responsive:[{breakpoint:1023,settings:{dots:!1}}]}),$(".product-page-slider-thumbs").slick({arrows:!1,dots:!1,mobileFirst:!0,slidesToShow:9,slidesToScroll:1,focusOnSelect:!0,asNavFor:".product-page-slider"})}if(!$.isEmptyObject(t[i].SIZES)){var o=!(n='<div class="table">\n<div class="table-row table-header">\n    <div class="table-cell"></div>\n    <div class="table-cell">\n        <p>Длина дужки</p>\n    </div>\n    <div class="table-cell">\n        <p>Ширина моста</p>\n    </div>\n    <div class="table-cell">\n        <p>Ширина линзы</p>\n    </div>\n    <div class="table-cell">\n        <p>Высота</p>\n    </div>\n    <div class="table-cell"></div>\n</div>');for(p in t[i].SIZES){var d=" disabled",c="";1==t[i].SIZES[p].UF_AVAIL&&(d=""),o||1!=t[i].SIZES[p].UF_AVAIL||(c=" checked",o=!0),n+='<div class="table-row'+d+'">\n    <div class="table-cell">\n        <label class="checkbox">\n            <input type="checkbox" name="type" value="'+p+'"'+c+'>\n            <div class="control__indicator"></div>\n        </label>\n    </div>\n    <div class="table-cell">\n        <p>'+t[i].SIZES[p].UF_DUZHKA+'</p>\n    </div>\n    <div class="table-cell">\n        <p>'+t[i].SIZES[p].UF_MOST+'</p>\n    </div>\n    <div class="table-cell">\n        <p>'+t[i].SIZES[p].UF_LINZA+'</p>\n    </div>\n    <div class="table-cell">\n        <p>'+t[i].SIZES[p].UF_HEIGHT+'</p>\n    </div>\n    <div class="table-cell">        <p>'+t[i].SIZES[p].UF_TOTAL+"</p>\n   </div>\n</div>"}n+="</div>"}r.find(".js-sizes_table").html(n)}}function isPiter(){return-1!=window.location.host.indexOf("spb")}maskInput(),$(document).ready(function(){var i,e=$("body");e.on("keyup",'[type="email"],[name="email"]',function(){var e=$(this).val();!(0<e.length)||isValidEmailAddress(e)?$(this).removeClass("error"):$(this).addClass("error")}),e.on("change",'[type="email"],[name="email"]',function(){var e=$(this).val();!(0<e.length)||isValidEmailAddress(e)?$(this).removeClass("error"):$(this).addClass("error")});var a=$(".js_citylist");$(".js-searchcity").keyup(function(){2<$(this).val().length?$.post(SITE_TEMPLATE_PATH+"ajax.php",{text:$(this).val(),action:"searchcity"},function(e){a.find(".custom").remove(),0<e.data.citylist.length?(a.find(".default").hide(),a.append(e.data.citylist)):a.find(".default").show()},"json"):(a.find(".custom").remove(),a.find(".default").show())});var t=$("#form-subscribe");t.find('[name="agree"]').change(function(){t.find('[name="agree"]').is(":checked")?t.find('[type="submit"]').prop("disabled",!1):t.find('[type="submit"]').prop("disabled",!0)}),t.submit(function(){var e=t.find('[name="email"]'),a=t.find('[name="agree"]').is(":checked");return 0==e.val().length&&e.addClass("error"),!e.hasClass("error")&&a&&$.post(SITE_TEMPLATE_PATH+"ajax.php",t.serialize(),function(){t.find(".js-body").html('<p class="tac">Вы успешно подписались на рассылку о новых тематических статьях, обзорах, новинках ассортимента и уникальных акциях нашего интернет-магазина.</p>')}),!1});var r=$("#form-review");r.find(".star").click(function(){var e=$(this).parent(),a=$(this).index();e.find(".star").removeClass("active");for(var t=0;t<=a;t++)e.find(".star").eq(t).addClass("active");return e.parent().find("input").val(a+1),!1}),r.find('[name="agree"]').change(function(){r.find('[name="agree"]').is(":checked")?r.find('[type="submit"]').prop("disabled",!1):r.find('[type="submit"]').prop("disabled",!0)}),r.submit(function(){var e=r.find('[name="email"]'),a=r.find('[name="text"]'),t=r.find('[name="agree"]').is(":checked"),i=!1;return r.find("input,select,textarea").removeClass("error"),0==e.val().length&&(e.addClass("error"),i=!0),0==a.val().length&&(a.addClass("error"),i=!0),!i&&t&&$.post(SITE_TEMPLATE_PATH+"ajax.php",r.serialize(),function(){r.html('<p class="tac">Ваш отзыв отправлен, после модерации он появится на сайте.</p>')}),!1}),$("#form-profile").submit(function(){var a=$(this);return a.find('[type="submit"]').prop("disabled",!0),a.find(".text-success").remove(),$.post(SITE_TEMPLATE_PATH+"ajax.php",$(this).serialize(),function(e){$("#form-profile").prepend('<div class="form-item text-success">'+e.data.text+"</div>"),a.find('[type="submit"]').prop("disabled",!1)},"json"),!1}),$("#UF_RECIPE").change(function(){var e=new FormData;e.append("file",$("#UF_RECIPE")[0].files[0]),e.append("action","recipe_file"),$.ajax({url:SITE_TEMPLATE_PATH+"ajax.php",type:"POST",data:e,dataType:"json",cache:!1,processData:!1,contentType:!1,success:function(e){$(".js-recipe_file").remove(),$(".recipe").after(e.data.text)}})}),$(document).on("click",".js-recipe_file",function(){$.post(SITE_TEMPLATE_PATH+"ajax.php",{action:"recipe_file"},function(){$(".js-recipe_file").remove()},"json")}),$(".js-recipe_text_show").click(function(){$(".js-recipe_text").show()}),$(".js-recipe_text textarea").keyup(function(){$.post(SITE_TEMPLATE_PATH+"ajax.php",{text:$(this).val(),action:"recipe_text"})}),$(".js-recipe_text textarea").change(function(){$.post(SITE_TEMPLATE_PATH+"ajax.php",{text:$(this).val(),action:"recipe_text"})}),e.on("click",".js-quick_see",function(e){return e.preventDefault(),$.post(SITE_TEMPLATE_PATH+"ajax.php",{id:$(this).data("id"),action:"quick"},function(e){e.error||($("#fast-view-modal .fast-view").html(e.data.text),$.magnificPopup.open({items:{src:"#fast-view-modal",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark",callbacks:{open:function(){$(".product-page-slider-fast").slick({arrows:!1,dots:!0,mobileFirst:!0,asNavFor:".product-page-slider-thumbs-fast",responsive:[{breakpoint:1023,settings:{dots:!1}}]}),$(".product-page-slider-thumbs-fast").slick({arrows:!1,dots:!1,mobileFirst:!0,slidesToShow:9,slidesToScroll:1,focusOnSelect:!0,asNavFor:".product-page-slider-fast"})},close:function(){$(".product-page-slider-fast").slick("destroy"),$(".product-page-slider-thumbs-fast").slick("destroy")}}}))},"json"),!1}),e.on("click",".js-buy",function(){var a=$(this).closest(".js-prod_card"),i=parseInt(a.find('[name="type"]:checked').val()),e=parseInt(a.find('[name="count"]').val()),r=$(this).data("id");return $.post(SITE_TEMPLATE_PATH+"ajax.php",{id:r,type:i,count:e,action:"prod_add"},function(e){var t;e.error||($("#to-cart-modal .js-img").attr("src",a.find(".js-prod_img").first().attr("src")),$("#to-cart-modal .js-name").html(a.find(".js-name").html()),$("#to-cart-modal .js-price").html(a.find(".js-prod_price_value").html()),a.find(".js-view-colors .active").length?($("#to-cart-modal .js-color").html(a.find(".js-view-colors:visible").find(".active").attr("title")),$("#to-cart-modal .js-color").parent().show()):$("#to-cart-modal .js-color").parent().hide(),0<i?(t="",a.find(".js-sizes_table input:checked").closest(".table-row").find("p").each(function(e,a){e<4&&(t+=$(this).text()+"-")}),$("#to-cart-modal .js-size").html(t.substr(0,t.length-1)),$("#to-cart-modal .js-size").parent().show()):$("#to-cart-modal .js-size").parent().hide(),a.find(".js-article")?($("#to-cart-modal .js-article").html(a.find(".js-article").html()),$("#to-cart-modal .js-article").parent().show()):$("#to-cart-modal .js-article").parent().hide(),$("#to-cart-modal .js-podbor").attr("href","/podbor/?id="+r),$.magnificPopup.open({items:{src:"#to-cart-modal",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"}),afterChangeBasket(e.data.basketData))},"json"),!1}),e.on("click",".js-basket_remove",function(){return $.post(SITE_TEMPLATE_PATH+"ajax.php",{id:$(this).data("id"),action:"prod_remove"},function(e){e.error||afterChangeBasket(e.data.basketData)},"json"),!1}),e.on("click",".js-basket_plus",function(){var e=$(this).closest(".cart-item-price-qty");$.post(SITE_TEMPLATE_PATH+"ajax.php",{id:e.data("id"),count:parseInt(e.find("input").val())+1,action:"prod_change"},function(e){e.error||afterChangeBasket(e.data.basketData)},"json")}),e.on("change",".js-basket_count",function(){var e=$(this).closest(".cart-item-price-qty");$(this).val(parseInt($(this).val())),$.post(SITE_TEMPLATE_PATH+"ajax.php",{id:e.data("id"),count:parseInt(e.find("input").val()),action:"prod_change"},function(e){e.error||afterChangeBasket(e.data.basketData)},"json")}),e.on("click",".js-basket_minus",function(){var e=$(this).closest(".cart-item-price-qty");1<parseInt(e.find("input").val())&&$.post(SITE_TEMPLATE_PATH+"ajax.php",{id:e.data("id"),count:parseInt(e.find("input").val())-1,action:"prod_change"},function(e){e.error||afterChangeBasket(e.data.basketData)},"json")}),e.on("click",".js-city",function(){return $.magnificPopup.open({items:{src:"#city-modal",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"}),!1}),e.on("click",".js-prod_order",function(){return $('#prod-order [name="id"]').val($(this).data("id")),$('#prod-order [name="type"]').val($(this).closest(".js-prod_card").find('[name="type"]:checked').val()),$.magnificPopup.open({items:{src:"#prod-order",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"}),!1}),e.on("click",".js-prod_order_spb",function(){return $('#prod-order_spb [name="id"]').val($(this).data("id")),$('#prod-order_spb [name="type"]').val($(this).closest(".js-prod_card").find('[name="type"]:checked').val()),$.magnificPopup.open({items:{src:"#prod-order_spb",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"}),!1}),e.on("click",".js-prod_preorder",function(){return $('#prod-preorder [name="id"]').val($(this).data("id")),$('#prod-preorder [name="type"]').val($(this).closest(".js-prod_card").find('[name="type"]:checked').val()),$.magnificPopup.open({items:{src:"#prod-preorder",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"}),!1});var s=$("#form-prod-order");s.find('[name="agree"]').change(function(){s.find('[name="agree"]').is(":checked")?s.find('[type="submit"]').prop("disabled",!1):s.find('[type="submit"]').prop("disabled",!0)}),s.submit(function(){var e=!1,a=s.find('[name="phone"]'),t=s.find('[name="agree"]').is(":checked");return s.find("input").removeClass("error"),0==a.val().length&&(a.addClass("error"),e=!0),!e&&t&&(s.find('[type="submit"]').prop("disabled",!0),$.post(SITE_TEMPLATE_PATH+"ajax.php",s.serialize(),function(){window.location.href="/spasibo"})),!1});var n=$("#form-prod-order_spb");n.find('[name="agree"]').change(function(){n.find('[name="agree"]').is(":checked")?n.find('[type="submit"]').prop("disabled",!1):n.find('[type="submit"]').prop("disabled",!0)}),n.submit(function(){var e=!1,a=n.find('[name="phone"]'),t=n.find('[name="agree"]').is(":checked");return n.find("input").removeClass("error"),0==a.val().length&&(a.addClass("error"),e=!0),!e&&t&&(n.find('[type="submit"]').prop("disabled",!0),$.post(SITE_TEMPLATE_PATH+"ajax.php",n.serialize(),function(){window.location.href="/spasibo"})),!1});var o=$("#form-prod-preorder");o.find('[name="agree"]').change(function(){o.find('[name="agree"]').is(":checked")?o.find('[type="submit"]').prop("disabled",!1):o.find('[type="submit"]').prop("disabled",!0)}),o.submit(function(){var e=!1,a=o.find('[name="phone"]'),t=o.find('[name="agree"]').is(":checked");return o.find("input").removeClass("error"),0==a.val().length&&(a.addClass("error"),e=!0),!e&&t&&(o.find('[type="submit"]').prop("disabled",!0),$.post(SITE_TEMPLATE_PATH+"ajax.php",o.serialize(),function(){window.location.href="/spasibo"})),!1}),e.on("click",".js-prod_orderprice",function(){return $('#prod-orderprice [name="id"]').val($(this).data("id")),$('#prod-orderprice [name="type"]').val($(this).closest(".js-prod_card").find('[name="type"]:checked').val()),$.magnificPopup.open({items:{src:"#prod-orderprice",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"}),!1});var d=$("#form-prod-orderprice");d.find('[name="agree"]').change(function(){d.find('[name="agree"]').is(":checked")?d.find('[type="submit"]').prop("disabled",!1):d.find('[type="submit"]').prop("disabled",!0)}),d.submit(function(){var e=!1,a=d.find('[name="phone"]'),t=d.find('[name="agree"]').is(":checked");return d.find("input").removeClass("error"),0==a.val().length&&(a.addClass("error"),e=!0),!e&&t&&(d.find('[type="submit"]').prop("disabled",!0),$.post(SITE_TEMPLATE_PATH+"ajax.php",d.serialize(),function(){window.location.href="/spasibo"})),!1}),e.on("change",".js-price_range",function(){var e=$(this).closest(".js-prop_wrap");e.find(".js-price_range").not($(this)).prop("checked",!1),$(this).is(":checked")?(e.find(".min-price").val($(this).data("from")),e.find(".max-price").val($(this).data("to"))):(e.find(".min-price").val(""),e.find(".max-price").val("")),e.find(".min-price").trigger("keyup"),e.find(".min-price").trigger("change")}),e.on("click","a.js-filter",function(){var a=$(this).attr("href");return $.get(a,function(e){$(".js-catalog_sort").html($(e).find(".js-catalog_sort").html()),$(".js-catalog_wrap").html($(e).find(".js-catalog_wrap").html()),$(".js-catalog_pagination").html($(e).find(".js-catalog_pagination").html()),$(".js-filter_reset").attr("href",$("#filter-side").data("reset-href")),$(".linkReplace").each(function(){var e=$(this).data("href"),a=$(this).attr("class"),t=$(this).data("ext"),i=$(this).html(),t="Y"==t?'target="_blank"':"";$(this).after('<a href="'+e+'" '+t+' class="'+a+'">'+i+"</a>").remove()}),history.pushState(null,null,a)}),!1}),e.on("change","input.js-filter",function(){return $("#"+$(this).data("filter")).trigger("click"),!1}),e.on("click",".js-openmap",function(){$.magnificPopup.close();var a=$(this).data("coord").split(","),t=$(this).data("name");return setTimeout(function(){$.magnificPopup.open({items:{src:"#map_city",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark",callbacks:{open:function(){i=new ymaps.Map("popup_salon_map",{center:a,zoom:10,controls:["zoomControl"]});var e=new ymaps.Placemark(a,{balloonContent:t});i.geoObjects.add(e)},close:function(){i.destroy()}}})},300),!1}),e.on("click",".js-view-colors li",function(){var e=$(this),a=e.closest(".js-view-colors"),t=e.closest(".js-prod_card"),i=e.data("pic"),r="";return a.find("li").removeClass("active"),e.addClass("active"),t.hasClass("product-page")||t.hasClass("fast-view")?changeOfferParams(offerParams,e):(0==i.length&&(i=SITE_TEMPLATE_PATH+"/img/no_photo.png"),t.find(".js-prod_img").attr("src",i),0<parseInt(e.data("oldprice"))?r+='<span class="product-price_old">'+e.data("oldprice")+' ₽</span><span class="product-price_current">'+e.data("price")+" ₽</span>":r+="<span><b>"+e.data("price")+" ₽</b></span>",t.find(".js-prod_price").html(r)),!1}),$(".js-link_register_popup").click(function(){return $.magnificPopup.open({items:{src:"#register-modal",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"}),!1}),$(".js-link_auth_popup").click(function(){return $.magnificPopup.open({items:{src:"#login-modal",type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"}),!1});var p=$("#form-register");p.submit(function(){var e=!1,a=p.find('[name="name"]'),t=p.find('[name="email"]'),i=p.find('[name="password"]'),r=p.find('[name="repassword"]');return p.find("input").removeClass("error"),p.find(".form-item-error").hide(),0==a.val().length&&(a.addClass("error"),e=!0),0==t.val().length&&(t.addClass("error"),e=!0),0==i.val().length&&(i.addClass("error"),e=!0),0==r.val().length&&(r.addClass("error"),e=!0),e||(p.find('[type="submit"]').prop("disabled",!0),$.post(SITE_TEMPLATE_PATH+"ajax.php",p.serialize(),function(e){e.error?(p.find(".form-item-error").html(e.error_text),p.find(".form-item-error").show(),p.find('[type="submit"]').prop("disabled",!1)):window.location.reload()},"json")),!1}),e.on("click",".qty-minus",function(){var e=$(this).closest(".cart-item-price-qty").find("input"),a=parseInt(e.val());return 1<a&&e.val(a-1),!1}),e.on("click",".qty-plus",function(){var e=$(this).closest(".cart-item-price-qty"),a=e.find("input"),t=parseInt(a.val());return t<parseInt(e.attr("data-count"))&&a.val(t+1),!1}),e.on("click",".js-load_more",function(){var a=$(this).attr("href");return $.get(a,function(e){$(".js-catalog_sort").html($(e).find(".js-catalog_sort").html()),$(".js-catalog_wrap .row:first-child").append($(e).find(".js-catalog_wrap .row:first-child").html()),$(".js-catalog_pagination").html($(e).find(".js-catalog_pagination").html()),history.pushState(null,null,a)}),!1}),e.on("click",".popup-link",function(){$.magnificPopup.open({items:{src:$(this).attr("href"),type:"inline",removalDelay:300},mainClass:"mfp-fade_dark"})}),$(".js-filter_reset").attr("href",$("#filter-side").data("reset-href")),$(".popup__image__show").on("click",function(e){e.preventDefault(),$.magnificPopup.close();var a=$(this);setTimeout(function(){$.magnificPopup.open({items:{src:a.attr("href"),type:"image"},closeOnContentClick:!0,image:{verticalFit:!0,titleSrc:function(e){return'<h4 style="color:#fff">'+a.attr("title")+"</h4>"}}})},500)})});